<% title "Project #{@project.name}, Iteration #{@iteration.iteration_number}" %>
<!--Rich, I know we won't want this here permanently, but this is to show how we could use this to create tabs for the
last x projects the user has accessed-->
<% Project.last_read(6, current_user).each do |project| %>
    <%= link_to_unless_current project.name, storyboard_project_path(project) %>&nbsp;&nbsp;&nbsp;
<% end %>

<br />
<br />
(<%= l(@iteration.start_on) %> to <%= l(@iteration.end_on) %>)
| <%= link_to_unless_current 'Taskboard', project_path(@project) %>
| <%= link_to_unless_current 'Storyboard', storyboard_project_path(@project) %>
| <%= link_to_unless_current 'Stats', stats_project_path(@project) %>
<% if can? :refresh_project, @project %>
    | <%= link_to 'Refresh', refresh_project_path(@project), :method => :post %>
    | <%= link_to 'Renumber', renumber_project_path(@project), :method => :post %>
<% end %>
<br/><br/>

<table>
  <tr>
    <th>Story</th>
    <th width="15%">Not Started</th>
    <th width="15%">In Progress</th>
    <th width="15%">Done</th>
    <th width="15%">Blocked</th>
  </tr>
  <% @iteration.decorated_stories("N", "N").each do |story| %>
      <tr>
        <td><strong><%= h story.name %></strong>
          <br/>
          (<%= h story.status.titleize %>, <%= pluralize(story.points, "point") %>, <%= story.owner_text %>)
        </td>
        <td>
          <% story.tasks_by_status("Not Started").each do |task| %>
              <%= TaskDecorator.decorate(task).post_it %>
          <% end %>
          &nbsp;
        </td>
        <td>
          <% story.tasks_by_status("In Progress").each do |task| %>
              <%= TaskDecorator.decorate(task).post_it %>
          <% end %>
          &nbsp;
        </td>
        <td>
          <% story.tasks_by_status("Done").each do |task| %>
              <%= TaskDecorator.decorate(task).post_it %>
          <% end %>
          &nbsp;
        </td>
        <td>
          <% story.tasks_by_status("Blocked").each do |task| %>
              <%= TaskDecorator.decorate(task).post_it %>
          <% end %>
          &nbsp;
        </td>
      </tr>
  <% end %>
</table>
